neutrino={ViewHubClient:function(a){var b=this;b.subscriptions_={};b.cookieProvider_=new neutrino.CookieProvider;b.eventEmitter_=new exports.EventEmitter;b.eventEmitter_.on("socketReady",function(){b.isSocketReady_=!0});b.sessionId=b.cookieProvider_.getCookie("sid");b.connect_(a)}};neutrino.ViewHubClient.prototype.isSocketReady_=!1;neutrino.ViewHubClient.prototype.eventEmitter_=null;neutrino.ViewHubClient.prototype.generateRequestId_=function(){return(new Date).getTime()+Math.random()};
neutrino.ViewHubClient.prototype.cookieProvider_=null;neutrino.ViewHubClient.prototype.subscriptions_=null;neutrino.ViewHubClient.prototype.socket_=null;
neutrino.ViewHubClient.prototype.connect_=function(a){var b=this;microAjax(a+"/getWorker",function(a){var a=(new Function("return "+a))(),c="http://"+a.host+":"+a.port;if(!a.host||!a.port)throw Error("Neutrino has no worker nodes");b.socket_=io.connect(c);b.socket_.on("newValue",function(a,c,d,h){b.newValueHandler_(a,c,d,h)});b.socket_.on("invokeMethodResponse",function(a){b.responseHandler_(a)});b.socket_.on("subscribeResponse",function(a){b.responseHandler_(a)});b.socket_.on("unsubscribeResponse",
    function(a){b.responseHandler_(a)});b.socket_.on("editResponse",function(a){b.responseHandler_(a)});b.socket_.on("getModelResponse",function(a){b.responseHandler_(a)});b.socket_.on("reconnect",function(){b.reconnectHandler_()});b.eventEmitter_.emit("socketReady")})};
neutrino.ViewHubClient.prototype.invoke=function(a,b,d){var c=this,e=c.generateRequestId_(),f=Array.prototype.slice.call(arguments,3),g=function(){!a||!b?d&&d(Error("View name and method name must be specified")):(c.eventEmitter_.once("response"+e,function(a){c.eventEmitter_.removeAllListeners("response"+e);a.success?d&&d(null,a.result):d&&d(Error("Server declined method invocation"))}),c.socket_.emit("invokeMethodRequest",{viewName:a,methodName:b,args:f,sessionId:c.sessionId,id:e}))};if(c.isSocketReady_)g();
else c.eventEmitter_.once("socketReady",g)};
neutrino.ViewHubClient.prototype.getModel=function(a,b){var d=this,c=d.generateRequestId_(),e=function(){a?(d.eventEmitter_.once("response"+c,function(a){d.eventEmitter_.removeAllListeners("response"+c);a.success?b&&b(null,a.model):b&&b(Error("Server declined model request"))}),d.socket_.emit("getModelRequest",{viewName:a,sessionId:d.sessionId,id:c})):b&&b(Error("View name must be specified"))};if(d.isSocketReady_)e();else d.eventEmitter_.once("socketReady",e)};
neutrino.ViewHubClient.prototype.setValue=function(a,b,d,c){var e=this,f=e.generateRequestId_(),g=function(){!a||!b?c&&c(Error("View name and property name must be specified")):(e.eventEmitter_.once("response"+f,function(a){e.eventEmitter_.removeAllListeners("response"+f);a.success?c&&c(null):c&&c(Error("Server declined new value of property"))}),e.socket_.emit("editRequest",{viewName:a,propertyName:b,newValue:d,sessionId:e.sessionId,id:f}))};if(e.isSocketReady_)g();else e.eventEmitter_.once("socketReady",
    g)};
neutrino.ViewHubClient.prototype.subscribe=function(a,b,d){if(!a||!b)d&&d(Error("View name and handler must be specified"));else{var c=this,e=c.generateRequestId_(),f=function(){c.eventEmitter_.once("response"+e,function(f){c.eventEmitter_.removeAllListeners("response"+e);f.success?(c.subscriptions_[a]||(c.subscriptions_[a]=[]),c.subscriptions_[a].push(b),d&&d(null)):d&&d(Error("Server declined subscription"))});c.socket_.emit("subscribeRequest",{viewName:a,sessionId:c.sessionId,id:e})};if(c.isSocketReady_)f();else c.eventEmitter_.once("socketReady",
    f)}};
neutrino.ViewHubClient.prototype.unsubscribe=function(a,b,d){if(!a||!b)d&&d(Error("View name and handler must be specified"));else if(!c.subscriptions_[a]||0===c.subscriptions_[a].length)d&&d(Error("This view has no subscriptions yet"));else{var c=this,e=c.generateRequestId_(),f=function(){c.eventEmitter_.once("response"+e,function(f){c.eventEmitter_.removeAllListeners("response"+e);var h=c.subscriptions_[a].indexOf(b);c.subscriptions_.splice(h,1);f.success?d&&d(null):d&&d(Error("Server declined unsubscribe message"))});c.socket_.emit("unsubscribeRequest",
    {viewName:a,sessionId:c.sessionId,id:e})};if(c.isSocketReady_)f();else c.eventEmitter_.once("socketReady",f)}};neutrino.ViewHubClient.prototype.reconnectHandler_=function(){for(var a in this.subscriptions_)if(this.subscriptions_.hasOwnProperty(a)){var b=this.generateRequestId_();this.socket_.emit("subscribeRequest",{viewName:a,sessionId:this.sessionId,id:b})}};
neutrino.ViewHubClient.prototype.responseHandler_=function(a){a.requestId&&a.sessionId&&(this.sessionId||(this.sessionId=a.sessionId,this.cookieProvider_.setCookie("sid",a.sessionId)),this.eventEmitter_.emit("response"+a.requestId,a.responseBody))};neutrino.ViewHubClient.prototype.newValueHandler_=function(a,b,d,c){this.subscriptions_.hasOwnProperty(a)&&this.subscriptions_[a].forEach(function(a){a(b,d,c)})};neutrino.CookieProvider=function(){};
neutrino.CookieProvider.prototype.setCookie=function(a,b,d,c,e,f){if(!a||!b)return!1;a=a+"="+encodeURIComponent(b);d&&(a+="; expires="+d.toGMTString());c&&(a+="; path="+c);e&&(a+="; domain="+e);f&&(a+="; secure");document.cookie=a;return!0};neutrino.CookieProvider.prototype.getCookie=function(a){return RegExp("(?:; )?"+a+"=([^;]*);?").test(document.cookie)?decodeURIComponent(RegExp.$1):null};neutrino.CookieProvider.prototype.removeCookie=function(a,b,d){this.setCookie(a,null,new Date(0),b,d);return!0};